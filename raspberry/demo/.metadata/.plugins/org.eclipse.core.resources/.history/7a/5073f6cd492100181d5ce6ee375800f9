package bs.pi.gateway.client.http;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.Set;

import net.sf.json.JSONObject;

import org.apache.http.NameValuePair;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpRequestBase;
import org.apache.http.message.BasicNameValuePair;

import bs.pi.gateway.main.Msg;
import bs.pi.gateway.main.MsgClient;
import bs.pi.gateway.main.MsgReceivedCallback;

public class HttpMsgClient {

	private static final String CFG_FILE_PATH = System.getProperty("file.separator")+"httpMsgClient.properties";
	private HttpMsgClientCfg cfg;
	private HttpMsgSender sender = new HttpMsgSender();
	//private MsgReceivedCallback callback;
	
	public HttpMsgClient(){
		cfg = new HttpMsgClientCfg(CFG_FILE_PATH);
	}

	public boolean send(JSONObject msg) {
		if(msg == null)
			return false;
		
		if(Msg.CMD_UPLOAD_SENSOR_DATA_TO_HTTP_SERVER.equals( msg.getString(Msg.KEY_CMD_NAME) )){
			String appID = msg.getString("appID");
			String value = msg.getString("value");
			JSONObject jo = new JSONObject();
			jo.put("serviceUrl", cfg.getServiceUrl());
			jo.put("apiKey", cfg.getApiKey());
			jo.put("deviceID", appID);
			jo.put("value", value);
			
			JSONObject response = sender.send(msg);
			if(response != null && response.has("success") && 
					"true".equals(response.getString("success"))){
				return true;
			}
			else{
				return false;
			}
		}else{
			return false;
		}
	}
	
	public JSONObject sendReturnResponse(JSONObject msg) {
		if(msg == null)
			return null;
		
		if(Msg.CMD_SEND_MSG_TO_HTTP_SERVER.equals( msg.getString(Msg.KEY_CMD_NAME) )){
			JSONObject jo = sender.send(msg);
			if(jo == null){
				return null;
			}
			else{
				JSONObject result = new JSONObject();
				result.put(Msg.KEY_CMD_NAME, Msg.CMD_HTTP_SERVER_RESPONSE);
				result.put("ResponseContent", jo);
				return result;
			}
		}else{
			return null;
		}
	}
	
}
