package com.zigbeee;

import java.util.Arrays;

//zigbeeÃüÁîbyteÐòÁÐÉú³ÉÆ÷
public class ZBCG {

	public final static byte SOF = (byte) 0xfe;
	public final static byte[] CMD_DEVICE_RESET = {SOF, 0x01, 0x41, 0x00, 0x00, 0x40};
	public final static byte[] CMD_BOOTLOADDER_RESET = {SOF, 0x01, 0x41, 0x00, 0x01, 0x41};
	public final static byte[] CMD_STARTUP_WITH_LAST_STATE = {SOF, 0x03, 0x26, 0x05, 0x03, 0x01, 0x00, 0x22};
	public final static byte[] CMD_STARTUP_WITHOUT_LAST_STATE = {SOF, 0x03, 0x26, 0x05, 0x03, 0x01, 0x03, 0x21};
	public final static byte[] STARTUP_FROM_APP = {SOF, 0x01, 0x25, 0x40, 0x00, 0x64};
	
	private static byte calCrc(byte[] bs){
		byte result = 0;
		for(byte b : bs)
			result ^= b;
		return result;
	}
	
	public static byte[] chanlistCfg(byte[] channel){
		byte[] bs = new byte[11];
		bs[0] = SOF;
		bs[1] = 0x06;
		bs[2] = 0x26;
		bs[3] = 0x05;
		bs[4] = (byte) 0x84;
		bs[5] = 0x04;
		bs[6] = channel[0]; 
		bs[7] = channel[1];
		bs[8] = channel[2];
		bs[9] = channel[3];
		bs[10] = calCrc(Arrays.copyOfRange(bs, 1, bs.length-1));
		return bs;
	}
	
	public static byte[] PANIDCfg(byte[] panid){
		byte[] bs = new byte[9];
		bs[0] = SOF;
		bs[1] = 0x04;
		bs[2] = 0x26;
		bs[3] = 0x05;
		bs[4] = (byte) 0x83;
		bs[5] = 0x02;
		bs[6] = panid[0];
		bs[7] = panid[1];
		bs[8] = calCrc(Arrays.copyOfRange(bs, 1, bs.length-1));
		return bs;
	}
	
	public static byte[] deviceTypeCfg(byte type)
	{
		byte[] bs = new byte[8];
		bs[0] = SOF;
		bs[1] = 0x03;
		bs[2] = 0x26;
		bs[3] = 0x05;
		bs[4] = (byte) 0x87;
		bs[5] = 0x01;
		bs[6] = type;
		bs[7] = calCrc(Arrays.copyOfRange(bs, 1, bs.length-1));
		return bs;
	}
	
	public static byte[] appRegister(ZBAppReg reg)
	{
		byte[] bs = new byte[77];
		bs[0] = SOF;
		bs[1] = (byte) (0x09 + reg.getAppNumInClusters() + reg.getAppNumOutClusters());
		bs[2] = 0x24;
		bs[3] = 0x00;
		bs[4] = reg.getEndpoint();
		bs[5] = reg.getAppProfID()[0];
		bs[6] = reg.getAppProfID()[1];
		bs[7] = reg.getAppDeviceID()[0];
		bs[8] = reg.getAppDeviceID()[1];
		bs[9] = reg.getEndDevVer();
		bs[10] = reg.getLatencyReq();
		bs[11] = reg.getAppNumInClusters();
		System.arraycopy(arg0, arg1, arg2, arg3, arg4);
		memcpy(&bs[12], reg.getAppInClusterList(), reg.getAppNumInClusters());
		int index = 12 + reg.getAppNumInClusters();
		bs[index] = reg.getAppNumOutClusters();
		index++;
		memcpy(&bs[index], reg.getAppOutClusterList(), sizeof(unsigned char)*reg.appNumOutClusters);
		index = index + reg.appNumOutClusters;
		zbCmd->len = index+1;
		bs[zbCmd->len-1] = calCrc(&bs[1], zbCmd->len-2);
	}
}
